(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _SW=__webpack_require__(13);var _SW2=_interopRequireDefault(_SW);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var serviceWorker=new _SW2.default(self).init()},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _config=__webpack_require__(3);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Logger=function(){function Logger(){_classCallCheck(this,Logger)}_createClass(Logger,null,[{key:"log",value:function log(args){if(_config.LOGGER_MODE>2)Logger._auxLogger(arguments,"log")}},{key:"info",value:function info(args){if(_config.LOGGER_MODE>1)Logger._auxLogger(arguments,"info")}},{key:"warn",value:function warn(args){if(_config.LOGGER_MODE)Logger._auxLogger(arguments,"warn")}},{key:"error",value:function error(args){if(_config.LOGGER_MODE)Logger._auxLogger(arguments,"error")}},{key:"_auxLogger",value:function _auxLogger(args,fn){for(var i=0;i<args.length;i++){console[fn](args[i])}}}]);return Logger}();exports.default=Logger},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _DB_KEYS;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var version=1;var API_DOMAIN=exports.API_DOMAIN="https://www.mrvoid-prototype.com/api";var LOGGER_MODE=exports.LOGGER_MODE=3;var MANIFESTO=exports.MANIFESTO={ID:"ve-push-gmanifest",URL:"https://raw.githubusercontent.com/Trazarw/Push-Notifications-Box/master/manifest.json"};var DB_KEYS=exports.DB_KEYS=(_DB_KEYS={NAME:"ve-push-db-v"+version,JOURNEY_ID:"JOURNEY_ID",SESSION_ID:"SESSION_ID",SUBSCRIPTION_ID:"SUBSCRIPTION_ID",VALUE_TO_CAPTURE:"VALUE_TO_CAPTURE",DEFAULT_NOTIFICATION:"DEFAULT_NOTIFICATION",PUSH_INFO:"PUSH_INFO"},_defineProperty(_DB_KEYS,"SESSION_ID","SESSION_ID"),_defineProperty(_DB_KEYS,"SESSION_TIME","SESSION_TIME"),_DB_KEYS)},,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _ApiBase2=__webpack_require__(7);var _ApiBase3=_interopRequireDefault(_ApiBase2);var _Logger=__webpack_require__(2);var _Logger2=_interopRequireDefault(_Logger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventLogger=function(_ApiBase){_inherits(EventLogger,_ApiBase);function EventLogger(journeyId,sessionId,subscriptionId){_classCallCheck(this,EventLogger);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(EventLogger).call(this,journeyId,sessionId,subscriptionId));_this.controller="EventCollector";_this.action="Send";_this.url=_this.getApiUrl(_this.controller,_this.action);return _this}_createClass(EventLogger,[{key:"log",value:function log(event){var eventType=void 0;switch(event){case"web-sw-registration":eventType=3;break;case"web-sw-unknow-error":eventType=4;break;case"web-sw-not-supported":eventType=5;break;case"sw-on-notification-push":eventType=6;break;case"sw-on-notification-click":eventType=7;break;case"sw-on-notification-close":eventType=8;break}_Logger2.default.info('EventLogger: Event "'+event+'" sent');var payload=this.getPayload();payload.eventType=eventType;return this.fetch(this.url,payload)}}]);return EventLogger}(_ApiBase3.default);exports.default=EventLogger},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Logger=__webpack_require__(2);var _Logger2=_interopRequireDefault(_Logger);var _config=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ApiBase=function(){function ApiBase(journeyId,sessionId,subscriptionId){_classCallCheck(this,ApiBase);this.urlPath=_config.API_DOMAIN;this.journeyId=journeyId;this.sessionId=sessionId;if(subscriptionId){this.setSubcriptionId(subscriptionId)}this.defaultSettings={method:"POST",mode:"cors",cache:"default",redirect:"follow",headers:new Headers({"Content-Type":"application/json"})}}_createClass(ApiBase,[{key:"setSubcriptionId",value:function setSubcriptionId(subscriptionId){this.subscriptionId=subscriptionId||"";return this}},{key:"fetch",value:function(_fetch){function fetch(_x,_x2,_x3){return _fetch.apply(this,arguments)}fetch.toString=function(){return _fetch.toString()};return fetch}(function(url,payload,settings){if(!settings)settings=this.defaultSettings;settings.body=JSON.stringify(payload);return fetch(url,settings).then(function(response){if(response.status!=200){_Logger2.default.warn("ApiBase: Response with status: "+response.status)}else{_Logger2.default.log("ApiBase: Response received from the API: "+url)}return response}).catch(function(error){_Logger2.default.error("ApiBase: ERROR: ",error);return error})})},{key:"getApiUrl",value:function getApiUrl(controller,method){return this.urlPath+"/"+controller+"/"+method}},{key:"getPayload",value:function getPayload(){return{journeyId:this.journeyId,sessionId:this.sessionId,subscriptionId:this.subscriptionId}}}]);return ApiBase}();exports.default=ApiBase},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _localForage=__webpack_require__(10);var _localForage2=_interopRequireDefault(_localForage);var _Logger=__webpack_require__(2);var _Logger2=_interopRequireDefault(_Logger);var _config=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var environment=void 0;var DataStore=function(){function DataStore(env){_classCallCheck(this,DataStore);_localForage2.default.config({name:_config.DB_KEYS.NAME});environment=env}_createClass(DataStore,null,[{key:"getItem",value:function getItem(key){return _localForage2.default.getItem(key).then(function(value){_Logger2.default.log("[DataStore] "+environment+": Retrieved key: "+key+" with value: "+value);return value}).catch(function(err){_Logger2.default.error("[DataStore] "+environment+": Error retrieving key: "+key+": "+err)})}},{key:"setItem",value:function setItem(key,value){return _localForage2.default.setItem(key,value).then(function(value){_Logger2.default.log("[DataStore] "+environment+": Set key: "+key+" with value: "+value);return value}).catch(function(err){_Logger2.default.error("[DataStore] "+environment+": Error setting key: "+key+": "+err)})}},{key:"removeItem",value:function removeItem(key){return _localForage2.default.removeItem(key).then(function(value){_Logger2.default.log("[DataStore] "+environment+": Removed key: "+key);return value}).catch(function(err){_Logger2.default.error("[DataStore] "+environment+": Error removing key: "+key+": "+err)})}}]);return DataStore}();exports.default=DataStore},function(module,exports,__webpack_require__){var require;var require;(function(global){(function(f){if(true){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.localforage=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";var immediate=_dereq_(2);function INTERNAL(){}var handlers={};var REJECTED=["REJECTED"];var FULFILLED=["FULFILLED"];var PENDING=["PENDING"];module.exports=exports=Promise;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function")}this.state=PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){safelyResolveThenable(this,resolver)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=="function"&&this.state===FULFILLED||typeof onRejected!=="function"&&this.state===REJECTED){return this}var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected))}return promise};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==="function"){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled}if(typeof onRejected==="function"){this.onRejected=onRejected;this.callRejected=this.otherCallRejected}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}if(returnValue===promise){handlers.reject(promise,new TypeError("Cannot resolve promise with itself"))}else{handlers.resolve(promise,returnValue)}})}handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==="error"){return handlers.reject(self,result.value)}var thenable=result.value;if(thenable){safelyResolveThenable(self,thenable)}else{self.state=FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value)}}return self};handlers.reject=function(self,error){self.state=REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error)}return self};function getThen(obj){var then=obj&&obj.then;if(obj&&typeof obj==="object"&&typeof then==="function"){return function appyThen(){then.apply(obj,arguments)}}}function safelyResolveThenable(self,thenable){var called=false;function onError(value){if(called){return}called=true;handlers.reject(self,value)}function onSuccess(value){if(called){return}called=true;handlers.resolve(self,value)}function tryToUnwrap(){thenable(onSuccess,onError)}var result=tryCatch(tryToUnwrap);if(result.status==="error"){onError(result.value)}}function tryCatch(func,value){var out={};try{out.value=func(value);out.status="success"}catch(e){out.status="error";out.value=e}return out}exports.resolve=resolve;function resolve(value){if(value instanceof this){return value}return handlers.resolve(new this(INTERNAL),value)}exports.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)}exports.all=all;function all(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var values=new Array(len);var resolved=0;var i=-1;var promise=new this(INTERNAL);while(++i<len){allResolver(iterable[i],i)}return promise;function allResolver(value,i){self.resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error)}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&&!called){called=true;handlers.resolve(promise,values)}}}}exports.race=race;function race(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var i=-1;var promise=new this(INTERNAL);while(++i<len){resolver(iterable[i])}return promise;function resolver(value){self.resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response)}},function(error){if(!called){called=true;handlers.reject(promise,error)}})}}},{2:2}],2:[function(_dereq_,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;{if(Mutation){var called=0;var observer=new Mutation(nextTick);var element=global.document.createTextNode("");observer.observe(element,{characterData:true});scheduleDrain=function(){element.data=called=++called%2}}else if(!global.setImmediate&&typeof global.MessageChannel!=="undefined"){var channel=new global.MessageChannel;channel.port1.onmessage=nextTick;scheduleDrain=function(){channel.port2.postMessage(0)}}else if("document"in global&&"onreadystatechange"in global.document.createElement("script")){scheduleDrain=function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null};global.document.documentElement.appendChild(scriptEl)}}else{scheduleDrain=function(){setTimeout(nextTick,0)}}}var draining;var queue=[];function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]()}len=queue.length}draining=false}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],3:[function(_dereq_,module,exports){(function(global){"use strict";if(typeof global.Promise!=="function"){global.Promise=_dereq_(1)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{1:1}],4:[function(_dereq_,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function getIDB(){if(typeof indexedDB!=="undefined"){return indexedDB}if(typeof webkitIndexedDB!=="undefined"){return webkitIndexedDB}if(typeof mozIndexedDB!=="undefined"){return mozIndexedDB}if(typeof OIndexedDB!=="undefined"){return OIndexedDB}if(typeof msIndexedDB!=="undefined"){return msIndexedDB}}var idb=getIDB();function isIndexedDBValid(){try{if(!idb){return false}if(typeof openDatabase!=="undefined"&&typeof navigator!=="undefined"&&navigator.userAgent&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)){return false}return idb&&typeof idb.open==="function"&&typeof IDBKeyRange!=="undefined"}catch(e){return false}}function isWebSQLValid(){return typeof openDatabase==="function"}function isLocalStorageValid(){try{return typeof localStorage!=="undefined"&&"setItem"in localStorage&&localStorage.setItem}catch(e){return false}}function createBlob(parts,properties){parts=parts||[];properties=properties||{};try{return new Blob(parts,properties)}catch(e){if(e.name!=="TypeError"){throw e}var Builder=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder;var builder=new Builder;for(var i=0;i<parts.length;i+=1){builder.append(parts[i])}return builder.getBlob(properties.type)}}if(typeof Promise==="undefined"&&typeof _dereq_!=="undefined"){_dereq_(3)}var Promise$1=Promise;function executeCallback(promise,callback){if(callback){promise.then(function(result){callback(null,result)},function(error){callback(error)})}}var DETECT_BLOB_SUPPORT_STORE="local-forage-detect-blob-support";var supportsBlobs;var dbContexts;function _binStringToArrayBuffer(bin){var length=bin.length;var buf=new ArrayBuffer(length);var arr=new Uint8Array(buf);for(var i=0;i<length;i++){arr[i]=bin.charCodeAt(i)}return buf}function _checkBlobSupportWithoutCaching(txn){return new Promise$1(function(resolve){var blob=createBlob([""]);txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,"key");txn.onabort=function(e){e.preventDefault();e.stopPropagation();resolve(false)};txn.oncomplete=function(){var matchedChrome=navigator.userAgent.match(/Chrome\/(\d+)/);var matchedEdge=navigator.userAgent.match(/Edge\//);resolve(matchedEdge||!matchedChrome||parseInt(matchedChrome[1],10)>=43)}})["catch"](function(){return false})}function _checkBlobSupport(idb){if(typeof supportsBlobs==="boolean"){return Promise$1.resolve(supportsBlobs)}return _checkBlobSupportWithoutCaching(idb).then(function(value){supportsBlobs=value;return supportsBlobs})}function _deferReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name];var deferredOperation={};deferredOperation.promise=new Promise$1(function(resolve){deferredOperation.resolve=resolve});dbContext.deferredOperations.push(deferredOperation);if(!dbContext.dbReady){dbContext.dbReady=deferredOperation.promise}else{dbContext.dbReady=dbContext.dbReady.then(function(){return deferredOperation.promise})}}function _advanceReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name];var deferredOperation=dbContext.deferredOperations.pop();if(deferredOperation){deferredOperation.resolve()}}function _getConnection(dbInfo,upgradeNeeded){return new Promise$1(function(resolve,reject){if(dbInfo.db){if(upgradeNeeded){_deferReadiness(dbInfo);dbInfo.db.close()}else{return resolve(dbInfo.db)}}var dbArgs=[dbInfo.name];if(upgradeNeeded){dbArgs.push(dbInfo.version)}var openreq=idb.open.apply(idb,dbArgs);if(upgradeNeeded){openreq.onupgradeneeded=function(e){var db=openreq.result;try{db.createObjectStore(dbInfo.storeName);if(e.oldVersion<=1){db.createObjectStore(DETECT_BLOB_SUPPORT_STORE)}}catch(ex){if(ex.name==="ConstraintError"){console.warn('The database "'+dbInfo.name+'"'+" has been upgraded from version "+e.oldVersion+" to version "+e.newVersion+', but the storage "'+dbInfo.storeName+'" already exists.')}else{throw ex}}}}openreq.onerror=function(){reject(openreq.error)};openreq.onsuccess=function(){resolve(openreq.result);_advanceReadiness(dbInfo)}})}function _getOriginalConnection(dbInfo){return _getConnection(dbInfo,false)}function _getUpgradedConnection(dbInfo){return _getConnection(dbInfo,true)}function _isUpgradeNeeded(dbInfo,defaultVersion){if(!dbInfo.db){return true}var isNewStore=!dbInfo.db.objectStoreNames.contains(dbInfo.storeName);var isDowngrade=dbInfo.version<dbInfo.db.version;var isUpgrade=dbInfo.version>dbInfo.db.version;if(isDowngrade){if(dbInfo.version!==defaultVersion){console.warn('The database "'+dbInfo.name+'"'+" can't be downgraded from version "+dbInfo.db.version+" to version "+dbInfo.version+".")}dbInfo.version=dbInfo.db.version}if(isUpgrade||isNewStore){if(isNewStore){var incVersion=dbInfo.db.version+1;if(incVersion>dbInfo.version){dbInfo.version=incVersion}}return true}return false}function _encodeBlob(blob){return new Promise$1(function(resolve,reject){var reader=new FileReader;reader.onerror=reject;reader.onloadend=function(e){var base64=btoa(e.target.result||"");resolve({__local_forage_encoded_blob:true,data:base64,type:blob.type})};reader.readAsBinaryString(blob)})}function _decodeBlob(encodedBlob){var arrayBuff=_binStringToArrayBuffer(atob(encodedBlob.data));return createBlob([arrayBuff],{type:encodedBlob.type})}function _isEncodedBlob(value){return value&&value.__local_forage_encoded_blob}function _fullyReady(callback){var self=this;var promise=self._initReady().then(function(){var dbContext=dbContexts[self._dbInfo.name];if(dbContext&&dbContext.dbReady){return dbContext.dbReady}});promise.then(callback,callback);return promise}function _initStorage(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=options[i]}}if(!dbContexts){dbContexts={}}var dbContext=dbContexts[dbInfo.name];if(!dbContext){dbContext={forages:[],db:null,dbReady:null,deferredOperations:[]};dbContexts[dbInfo.name]=dbContext}dbContext.forages.push(self);if(!self._initReady){self._initReady=self.ready;self.ready=_fullyReady}var initPromises=[];function ignoreErrors(){return Promise$1.resolve()}for(var j=0;j<dbContext.forages.length;j++){var forage=dbContext.forages[j];if(forage!==self){initPromises.push(forage._initReady()["catch"](ignoreErrors))}}var forages=dbContext.forages.slice(0);return Promise$1.all(initPromises).then(function(){dbInfo.db=dbContext.db;return _getOriginalConnection(dbInfo)}).then(function(db){dbInfo.db=db;if(_isUpgradeNeeded(dbInfo,self._defaultConfig.version)){return _getUpgradedConnection(dbInfo)}return db}).then(function(db){dbInfo.db=dbContext.db=db;self._dbInfo=dbInfo;for(var k=0;k<forages.length;k++){var forage=forages[k];if(forage!==self){forage._dbInfo.db=dbInfo.db;forage._dbInfo.version=dbInfo.version}}})}function getItem(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.get(key);req.onsuccess=function(){var value=req.result;if(value===undefined){value=null}if(_isEncodedBlob(value)){value=_decodeBlob(value)}resolve(value)};req.onerror=function(){reject(req.error)}})["catch"](reject)});executeCallback(promise,callback);return promise}function iterate(iterator,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.openCursor();var iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var value=cursor.value;if(_isEncodedBlob(value)){value=_decodeBlob(value)}var result=iterator(value,cursor.key,iterationNumber++);if(result!==void 0){resolve(result)}else{cursor["continue"]()}}else{resolve()}};req.onerror=function(){reject(req.error)}})["catch"](reject)});executeCallback(promise,callback);return promise}function setItem(key,value,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){var dbInfo;self.ready().then(function(){dbInfo=self._dbInfo;if(value instanceof Blob){return _checkBlobSupport(dbInfo.db).then(function(blobSupport){if(blobSupport){return value}return _encodeBlob(value)})}return value}).then(function(value){var transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite");var store=transaction.objectStore(dbInfo.storeName);if(value===null){value=undefined}transaction.oncomplete=function(){if(value===undefined){value=null}resolve(value)};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)};var req=store.put(value,key)})["catch"](reject)});executeCallback(promise,callback);return promise}function removeItem(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite");var store=transaction.objectStore(dbInfo.storeName);var req=store["delete"](key);transaction.oncomplete=function(){resolve()};transaction.onerror=function(){reject(req.error)};transaction.onabort=function(){var err=req.error?req.error:req.transaction.error;reject(err)}})["catch"](reject)});executeCallback(promise,callback);return promise}function clear(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite");var store=transaction.objectStore(dbInfo.storeName);var req=store.clear();transaction.oncomplete=function(){resolve()};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)}})["catch"](reject)});executeCallback(promise,callback);return promise}function length(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.count();req.onsuccess=function(){resolve(req.result)};req.onerror=function(){reject(req.error)}})["catch"](reject)});executeCallback(promise,callback);return promise}function key(n,callback){var self=this;var promise=new Promise$1(function(resolve,reject){if(n<0){resolve(null);return}self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var advanced=false;var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(null);return}if(n===0){resolve(cursor.key)}else{if(!advanced){advanced=true;cursor.advance(n)}else{resolve(cursor.key)}}};req.onerror=function(){reject(req.error)}})["catch"](reject)});executeCallback(promise,callback);return promise}function keys(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.openCursor();var keys=[];req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(keys);return}keys.push(cursor.key);cursor["continue"]()};req.onerror=function(){reject(req.error)}})["catch"](reject)});executeCallback(promise,callback);return promise}var asyncStorage={_driver:"asyncStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var BLOB_TYPE_PREFIX="~~local_forage_type~";var BLOB_TYPE_PREFIX_REGEX=/^~~local_forage_type~([^~]+)~/;var SERIALIZED_MARKER="__lfsc__:";var SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length;var TYPE_ARRAYBUFFER="arbf";var TYPE_BLOB="blob";var TYPE_INT8ARRAY="si08";var TYPE_UINT8ARRAY="ui08";var TYPE_UINT8CLAMPEDARRAY="uic8";var TYPE_INT16ARRAY="si16";var TYPE_INT32ARRAY="si32";var TYPE_UINT16ARRAY="ur16";var TYPE_UINT32ARRAY="ui32";var TYPE_FLOAT32ARRAY="fl32";var TYPE_FLOAT64ARRAY="fl64";var TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length;function stringToBuffer(serializedString){var bufferLength=serializedString.length*.75;var len=serializedString.length;var i;var p=0;var encoded1,encoded2,encoded3,encoded4;if(serializedString[serializedString.length-1]==="="){bufferLength--;if(serializedString[serializedString.length-2]==="="){bufferLength--}}var buffer=new ArrayBuffer(bufferLength);var bytes=new Uint8Array(buffer);for(i=0;i<len;i+=4){encoded1=BASE_CHARS.indexOf(serializedString[i]);encoded2=BASE_CHARS.indexOf(serializedString[i+1]);encoded3=BASE_CHARS.indexOf(serializedString[i+2]);encoded4=BASE_CHARS.indexOf(serializedString[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return buffer}function bufferToString(buffer){var bytes=new Uint8Array(buffer);var base64String="";var i;for(i=0;i<bytes.length;i+=3){base64String+=BASE_CHARS[bytes[i]>>2];base64String+=BASE_CHARS[(bytes[i]&3)<<4|bytes[i+1]>>4];base64String+=BASE_CHARS[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64String+=BASE_CHARS[bytes[i+2]&63]}if(bytes.length%3===2){base64String=base64String.substring(0,base64String.length-1)+"="}else if(bytes.length%3===1){base64String=base64String.substring(0,base64String.length-2)+"=="}return base64String}function serialize(value,callback){var valueString="";if(value){valueString=value.toString()}if(value&&(value.toString()==="[object ArrayBuffer]"||value.buffer&&value.buffer.toString()==="[object ArrayBuffer]")){var buffer;var marker=SERIALIZED_MARKER;if(value instanceof ArrayBuffer){buffer=value;marker+=TYPE_ARRAYBUFFER}else{buffer=value.buffer;
if(valueString==="[object Int8Array]"){marker+=TYPE_INT8ARRAY}else if(valueString==="[object Uint8Array]"){marker+=TYPE_UINT8ARRAY}else if(valueString==="[object Uint8ClampedArray]"){marker+=TYPE_UINT8CLAMPEDARRAY}else if(valueString==="[object Int16Array]"){marker+=TYPE_INT16ARRAY}else if(valueString==="[object Uint16Array]"){marker+=TYPE_UINT16ARRAY}else if(valueString==="[object Int32Array]"){marker+=TYPE_INT32ARRAY}else if(valueString==="[object Uint32Array]"){marker+=TYPE_UINT32ARRAY}else if(valueString==="[object Float32Array]"){marker+=TYPE_FLOAT32ARRAY}else if(valueString==="[object Float64Array]"){marker+=TYPE_FLOAT64ARRAY}else{callback(new Error("Failed to get type for BinaryArray"))}}callback(marker+bufferToString(buffer))}else if(valueString==="[object Blob]"){var fileReader=new FileReader;fileReader.onload=function(){var str=BLOB_TYPE_PREFIX+value.type+"~"+bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)};fileReader.readAsArrayBuffer(value)}else{try{callback(JSON.stringify(value))}catch(e){console.error("Couldn't convert value into a JSON string: ",value);callback(null,e)}}}function deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER){return JSON.parse(value)}var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH);var type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH);var blobType;if(type===TYPE_BLOB&&BLOB_TYPE_PREFIX_REGEX.test(serializedString)){var matcher=serializedString.match(BLOB_TYPE_PREFIX_REGEX);blobType=matcher[1];serializedString=serializedString.substring(matcher[0].length)}var buffer=stringToBuffer(serializedString);switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return createBlob([buffer],{type:blobType});case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}var localforageSerializer={serialize:serialize,deserialize:deserialize,stringToBuffer:stringToBuffer,bufferToString:bufferToString};function _initStorage$1(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=typeof options[i]!=="string"?options[i].toString():options[i]}}var dbInfoPromise=new Promise$1(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size)}catch(e){return reject(e)}dbInfo.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){self._dbInfo=dbInfo;resolve()},function(t,error){reject(error)})})});dbInfo.serializer=localforageSerializer;return dbInfoPromise}function getItem$1(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;if(result){result=dbInfo.serializer.deserialize(result)}resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function iterate$1(iterator,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName,[],function(t,results){var rows=results.rows;var length=rows.length;for(var i=0;i<length;i++){var item=rows.item(i);var result=item.value;if(result){result=dbInfo.serializer.deserialize(result)}result=iterator(result,item.key,i+1);if(result!==void 0){resolve(result);return}}resolve()},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function setItem$1(key,value,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){if(value===undefined){value=null}var originalValue=value;var dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){if(error){reject(error)}else{dbInfo.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key,value],function(){resolve(originalValue)},function(t,error){reject(error)})},function(sqlError){if(sqlError.code===sqlError.QUOTA_ERR){reject(sqlError)}})}})})["catch"](reject)});executeCallback(promise,callback);return promise}function removeItem$1(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key],function(){resolve()},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function clear$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function length$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function key$1(n,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}function keys$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName,[],function(t,results){var keys=[];for(var i=0;i<results.rows.length;i++){keys.push(results.rows.item(i).key)}resolve(keys)},function(t,error){reject(error)})})})["catch"](reject)});executeCallback(promise,callback);return promise}var webSQLStorage={_driver:"webSQLStorage",_initStorage:_initStorage$1,iterate:iterate$1,getItem:getItem$1,setItem:setItem$1,removeItem:removeItem$1,clear:clear$1,length:length$1,key:key$1,keys:keys$1};function _initStorage$2(options){var self=this;var dbInfo={};if(options){for(var i in options){dbInfo[i]=options[i]}}dbInfo.keyPrefix=dbInfo.name+"/";if(dbInfo.storeName!==self._defaultConfig.storeName){dbInfo.keyPrefix+=dbInfo.storeName+"/"}self._dbInfo=dbInfo;dbInfo.serializer=localforageSerializer;return Promise$1.resolve()}function clear$2(callback){var self=this;var promise=self.ready().then(function(){var keyPrefix=self._dbInfo.keyPrefix;for(var i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key)}}});executeCallback(promise,callback);return promise}function getItem$2(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var result=localStorage.getItem(dbInfo.keyPrefix+key);if(result){result=dbInfo.serializer.deserialize(result)}return result});executeCallback(promise,callback);return promise}function iterate$2(iterator,callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var keyPrefix=dbInfo.keyPrefix;var keyPrefixLength=keyPrefix.length;var length=localStorage.length;var iterationNumber=1;for(var i=0;i<length;i++){var key=localStorage.key(i);if(key.indexOf(keyPrefix)!==0){continue}var value=localStorage.getItem(key);if(value){value=dbInfo.serializer.deserialize(value)}value=iterator(value,key.substring(keyPrefixLength),iterationNumber++);if(value!==void 0){return value}}});executeCallback(promise,callback);return promise}function key$2(n,callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var result;try{result=localStorage.key(n)}catch(error){result=null}if(result){result=result.substring(dbInfo.keyPrefix.length)}return result});executeCallback(promise,callback);return promise}function keys$2(callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var length=localStorage.length;var keys=[];for(var i=0;i<length;i++){if(localStorage.key(i).indexOf(dbInfo.keyPrefix)===0){keys.push(localStorage.key(i).substring(dbInfo.keyPrefix.length))}}return keys});executeCallback(promise,callback);return promise}function length$2(callback){var self=this;var promise=self.keys().then(function(keys){return keys.length});executeCallback(promise,callback);return promise}function removeItem$2(key,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key)});executeCallback(promise,callback);return promise}function setItem$2(key,value,callback){var self=this;if(typeof key!=="string"){console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=self.ready().then(function(){if(value===undefined){value=null}var originalValue=value;return new Promise$1(function(resolve,reject){var dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){if(error){reject(error)}else{try{localStorage.setItem(dbInfo.keyPrefix+key,value);resolve(originalValue)}catch(e){if(e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED"){reject(e)}reject(e)}}})})});executeCallback(promise,callback);return promise}var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:_initStorage$2,iterate:iterate$2,getItem:getItem$2,setItem:setItem$2,removeItem:removeItem$2,clear:clear$2,length:length$2,key:key$2,keys:keys$2};function executeTwoCallbacks(promise,callback,errorCallback){if(typeof callback==="function"){promise.then(callback)}if(typeof errorCallback==="function"){promise["catch"](errorCallback)}}var CustomDrivers={};var DriverType={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"};var DefaultDriverOrder=[DriverType.INDEXEDDB,DriverType.WEBSQL,DriverType.LOCALSTORAGE];var LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"];var DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};var driverSupport={};driverSupport[DriverType.INDEXEDDB]=isIndexedDBValid();driverSupport[DriverType.WEBSQL]=isWebSQLValid();driverSupport[DriverType.LOCALSTORAGE]=isLocalStorageValid();var isArray=Array.isArray||function(arg){return Object.prototype.toString.call(arg)==="[object Array]"};function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg){for(var key in arg){if(arg.hasOwnProperty(key)){if(isArray(arg[key])){arguments[0][key]=arg[key].slice()}else{arguments[0][key]=arg[key]}}}}}return arguments[0]}function isLibraryDriver(driverName){for(var driver in DriverType){if(DriverType.hasOwnProperty(driver)&&DriverType[driver]===driverName){return true}}return false}var LocalForage=function(){function LocalForage(options){_classCallCheck(this,LocalForage);this.INDEXEDDB=DriverType.INDEXEDDB;this.LOCALSTORAGE=DriverType.LOCALSTORAGE;this.WEBSQL=DriverType.WEBSQL;this._defaultConfig=extend({},DefaultConfig);this._config=extend({},this._defaultConfig,options);this._driverSet=null;this._initDriver=null;this._ready=false;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)}LocalForage.prototype.config=function config(options){if((typeof options==="undefined"?"undefined":_typeof(options))==="object"){if(this._ready){return new Error("Can't call config() after localforage "+"has been used.")}for(var i in options){if(i==="storeName"){options[i]=options[i].replace(/\W/g,"_")}this._config[i]=options[i]}if("driver"in options&&options.driver){this.setDriver(this._config.driver)}return true}else if(typeof options==="string"){return this._config[options]}else{return this._config}};LocalForage.prototype.defineDriver=function defineDriver(driverObject,callback,errorCallback){var promise=new Promise$1(function(resolve,reject){try{var driverName=driverObject._driver;var complianceError=new Error("Custom driver not compliant; see "+"https://mozilla.github.io/localForage/#definedriver");var namingError=new Error("Custom driver name already in use: "+driverObject._driver);if(!driverObject._driver){reject(complianceError);return}if(isLibraryDriver(driverObject._driver)){reject(namingError);return}var customDriverMethods=LibraryMethods.concat("_initStorage");for(var i=0;i<customDriverMethods.length;i++){var customDriverMethod=customDriverMethods[i];if(!customDriverMethod||!driverObject[customDriverMethod]||typeof driverObject[customDriverMethod]!=="function"){reject(complianceError);return}}var supportPromise=Promise$1.resolve(true);if("_support"in driverObject){if(driverObject._support&&typeof driverObject._support==="function"){supportPromise=driverObject._support()}else{supportPromise=Promise$1.resolve(!!driverObject._support)}}supportPromise.then(function(supportResult){driverSupport[driverName]=supportResult;CustomDrivers[driverName]=driverObject;resolve()},reject)}catch(e){reject(e)}});executeTwoCallbacks(promise,callback,errorCallback);return promise};LocalForage.prototype.driver=function driver(){return this._driver||null};LocalForage.prototype.getDriver=function getDriver(driverName,callback,errorCallback){var self=this;var getDriverPromise=Promise$1.resolve().then(function(){if(isLibraryDriver(driverName)){switch(driverName){case self.INDEXEDDB:return asyncStorage;case self.LOCALSTORAGE:return localStorageWrapper;case self.WEBSQL:return webSQLStorage}}else if(CustomDrivers[driverName]){return CustomDrivers[driverName]}else{throw new Error("Driver not found.")}});executeTwoCallbacks(getDriverPromise,callback,errorCallback);return getDriverPromise};LocalForage.prototype.getSerializer=function getSerializer(callback){var serializerPromise=Promise$1.resolve(localforageSerializer);executeTwoCallbacks(serializerPromise,callback);return serializerPromise};LocalForage.prototype.ready=function ready(callback){var self=this;var promise=self._driverSet.then(function(){if(self._ready===null){self._ready=self._initDriver()}return self._ready});executeTwoCallbacks(promise,callback,callback);return promise};LocalForage.prototype.setDriver=function setDriver(drivers,callback,errorCallback){var self=this;if(!isArray(drivers)){drivers=[drivers]}var supportedDrivers=this._getSupportedDrivers(drivers);function setDriverToConfig(){self._config.driver=self.driver()}function initDriver(supportedDrivers){return function(){var currentDriverIndex=0;function driverPromiseLoop(){while(currentDriverIndex<supportedDrivers.length){var driverName=supportedDrivers[currentDriverIndex];currentDriverIndex++;self._dbInfo=null;self._ready=null;return self.getDriver(driverName).then(function(driver){self._extend(driver);setDriverToConfig();self._ready=self._initStorage(self._config);return self._ready})["catch"](driverPromiseLoop)}setDriverToConfig();var error=new Error("No available storage method found.");self._driverSet=Promise$1.reject(error);return self._driverSet}return driverPromiseLoop()}}var oldDriverSetDone=this._driverSet!==null?this._driverSet["catch"](function(){return Promise$1.resolve()}):Promise$1.resolve();this._driverSet=oldDriverSetDone.then(function(){var driverName=supportedDrivers[0];self._dbInfo=null;self._ready=null;return self.getDriver(driverName).then(function(driver){self._driver=driver._driver;setDriverToConfig();self._wrapLibraryMethodsWithReady();self._initDriver=initDriver(supportedDrivers)})})["catch"](function(){setDriverToConfig();var error=new Error("No available storage method found.");self._driverSet=Promise$1.reject(error);return self._driverSet});executeTwoCallbacks(this._driverSet,callback,errorCallback);return this._driverSet};LocalForage.prototype.supports=function supports(driverName){return!!driverSupport[driverName]};LocalForage.prototype._extend=function _extend(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)};LocalForage.prototype._getSupportedDrivers=function _getSupportedDrivers(drivers){var supportedDrivers=[];for(var i=0,len=drivers.length;i<len;i++){var driverName=drivers[i];if(this.supports(driverName)){supportedDrivers.push(driverName)}}return supportedDrivers};LocalForage.prototype._wrapLibraryMethodsWithReady=function _wrapLibraryMethodsWithReady(){for(var i=0;i<LibraryMethods.length;i++){callWhenReady(this,LibraryMethods[i])}};LocalForage.prototype.createInstance=function createInstance(options){return new LocalForage(options)};return LocalForage}();var localforage_js=new LocalForage;module.exports=localforage_js},{3:3}]},{},[4])(4)})}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _DataStore=__webpack_require__(9);var _DataStore2=_interopRequireDefault(_DataStore);var _config=__webpack_require__(3);var _utils=__webpack_require__(12);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ClientSettings=function(){function ClientSettings(){_classCallCheck(this,ClientSettings);if(!(0,_utils.isServiceWorker)()){if(typeof veTagData==="undefined"){this.settingsData={journeyId:5645,sessionId:window.navigator.userAgent+"_"+window.navigator.productSub,pushInfo:{defaultUrl:"http://localhost:8080/Basket.html",defaultNotification:{title:"title",body:"body",tag:"tag",icon:"https://fs02.androidpit.info/a/1b/70/anime-wallpapers-hd-1b70ff-w192.png"}},captureSettings:{basketURL:/basket.html/,completeURL:/complete.html/,products:"#valueToCapture"}}}else{this.settingsData={journeyId:veTagData.captureConfig.JourneyId,sessionId:"dummy-session-id",pushInfo:veTagData.settings.pushNotifications,captureSettings:veTagData.settings.pushCaptureSettings}}}}_createClass(ClientSettings,[{key:"getData",value:function getData(elements){var _this=this;if(!(0,_utils.isServiceWorker)()){return new Promise(function(resolve,reject){resolve(_this.settingsData)})}else{if(elements){var thisElement=void 0;var promises=[];for(var i=elements.length-1;i>=0;i--){promises.push(ClientSettings.getKey(elements[i]))}}else{var _ret=function(){var result={};return{v:_DataStore2.default.getItem(_config.DB_KEYS.JOURNEY_ID).then(function(journeyId){result.journeyId=journeyId}).then(function(){return _DataStore2.default.getItem(_config.DB_KEYS.SESSION_ID)}).then(function(sessionId){result.sessionId=sessionId}).then(function(){return _DataStore2.default.getItem(_config.DB_KEYS.SUBSCRIPTION_ID)}).then(function(subscriptionId){result.subscriptionId=subscriptionId}).then(function(){return _DataStore2.default.getItem(_config.DB_KEYS.PUSH_INFO)}).then(function(pushInfo){result.pushInfo=pushInfo;return new Promise(function(resolve,reject){if(!(0,_utils.isServiceWorker)()){result.captureSettings=_this.settingsData.captureSettings}resolve(result)})}).catch(function(err){return new Promise(function(resolve,reject){reject(err)})})}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}}}},{key:"saveData",value:function saveData(data){if(!(0,_utils.isServiceWorker)()){_DataStore2.default.setItem(_config.DB_KEYS.JOURNEY_ID,data.journeyId);_DataStore2.default.setItem(_config.DB_KEYS.SESSION_ID,data.sessionId);_DataStore2.default.setItem(_config.DB_KEYS.PUSH_INFO,data.pushInfo)}}}],[{key:"getKey",value:function getKey(key){return _DataStore2.default.getItem(_config.DB_KEYS[key]).then(function(result){return result})}},{key:"getJourneyId",value:function getJourneyId(){return _DataStore2.default.getItem(_config.DB_KEYS.JOURNEY_ID).then(function(journeyId){return journeyId})}}]);return ClientSettings}();exports.default=ClientSettings},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isServiceWorker=isServiceWorker;function isServiceWorker(){if(typeof window==="undefined"){if(typeof WorkerLocation!=="undefined"&&location instanceof WorkerLocation)return true}return false}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _EventLogger=__webpack_require__(6);var _EventLogger2=_interopRequireDefault(_EventLogger);var _Logger=__webpack_require__(2);var _Logger2=_interopRequireDefault(_Logger);var _NotificationData=__webpack_require__(14);var _NotificationData2=_interopRequireDefault(_NotificationData);var _DataStore=__webpack_require__(9);var _DataStore2=_interopRequireDefault(_DataStore);var _ClientSettings=__webpack_require__(11);var _ClientSettings2=_interopRequireDefault(_ClientSettings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SW=function(){function SW(self){_classCallCheck(this,SW);this.self=self}_createClass(SW,[{key:"init",value:function init(){var self=this.self;new _DataStore2.default("WebPage");_Logger2.default.log("[SW]: Adding events");self.addEventListener("install",this.onInstall);self.addEventListener("activate",this.onActivate);self.addEventListener("message",this.onMessage);self.addEventListener("push",this.onPush);self.addEventListener("notificationclick",this.onNotificationClick);self.addEventListener("notificationclose",this.onNotificationClose);var eventLogger=void 0;SW.getClientSettings().then(function(clientSettings){eventLogger=new _EventLogger2.default(clientSettings.journeyId,clientSettings.sessionId,clientSettings.subscriptionId)});return this}},{key:"onPush",value:function onPush(event){_Logger2.default.info("[SW]: On Push Message "+JSON.stringify(event,null,4),event);var notificationData=null;console.log(this.defaultUrl);console.log(this.defaultUrl);event.waitUntil(SW.getClientSettings().then(function(clientSettings){notificationData=new _NotificationData2.default(clientSettings.journeyId,clientSettings.sessionId,clientSettings.subscriptionId,clientSettings.pushInfo,event.data)}).then(function(){notificationData.get().then(function(notification){return SW.displayNotification(notification).then(function(){_Logger2.default.info("[SW]: Notification displayed")})})}));SW.swEventLog("sw-on-notification-push")}},{key:"onNotificationClick",value:function onNotificationClick(event){_Logger2.default.info("[SW]: On onNotificationClick "+JSON.stringify(event,null,4),event);event.notification.close();event.waitUntil(SW.getClientSettings().then(function(clientSettings){var url=clientSettings.pushInfo.defaultUrl;return clients.matchAll({type:"window"}).then(function(windowClients){for(var i=0;i<windowClients.length;i++){var client=windowClients[i];if(client.url===url&&"focus"in client){return client.focus()}}if(clients.openWindow){return clients.openWindow(url)}})}));SW.swEventLog("sw-on-notification-click")}},{key:"onInstall",value:function onInstall(event){_Logger2.default.info("[SW]: Installed "+JSON.stringify(event,null,4),event);self.skipWaiting();console.log(this)}},{key:"onActivate",value:function onActivate(event){_Logger2.default.info("[SW]:  Activated",event)}},{key:"onMessage",value:function onMessage(event){_Logger2.default.info("[SW]: Received Message: "+event.data);if(event.ports[0]){event.ports[0].postMessage("[SW] Says 'Hello back!'")}}},{key:"onNotificationClose",value:function onNotificationClose(event){_Logger2.default.info("[SW]:  Notification Closed",event);SW.swEventLog("sw-on-notification-close")}}],[{key:"swEventLog",value:function swEventLog(eventName){if(!eventLogger){SW.getClientSettings().then(function(clientSettings){eventLogger=new _EventLogger2.default(clientSettings.journeyId,clientSettings.sessionId,clientSettings.subscriptionId);eventLogger.log(eventName)})}else{eventLogger.log(eventName)}}},{key:"getClientSettings",value:function getClientSettings(elements){var client=new _ClientSettings2.default;return client.getData(elements).then(function(clientSettings){_Logger2.default.log("[SW]: Getting clientSettings");_Logger2.default.log(clientSettings);return clientSettings})}},{key:"createNotification",value:function createNotification(data){var title=data.title;var body=data.body;var icon=data.icon;var tag=data.tag;return{title:title,body:body,icon:icon,tag:tag}}},{key:"displayNotification",value:function displayNotification(notification){return self.registration.showNotification(notification.title,{body:notification.body,icon:notification.icon,tag:notification.tag})}},{key:"splitEndPointSubscription",value:function splitEndPointSubscription(subscriptionDetails){var endpointURL="https://android.googleapis.com/gcm/send/",endpoint=subscriptionDetails.endpoint,subscriptionId;if(endpoint.indexOf(endpointURL)===0){return subscriptionId=endpoint.replace(endpointURL,"")}return subscriptionDetails.subscriptionId}}]);return SW}();exports.default=SW},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _DataStore=__webpack_require__(9);var _DataStore2=_interopRequireDefault(_DataStore);var _ApiBase2=__webpack_require__(7);var _ApiBase3=_interopRequireDefault(_ApiBase2);var _Logger=__webpack_require__(2);var _Logger2=_interopRequireDefault(_Logger);var _config=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NotificationData=function(_ApiBase){_inherits(NotificationData,_ApiBase);function NotificationData(journeyId,sessionId,subscriptionId,pushInfo,data){_classCallCheck(this,NotificationData);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(NotificationData).call(this,journeyId,sessionId,subscriptionId));_this.data=data;_this.controller="pushData";_this.action="get";_this.defaultNotification=pushInfo.defaultNotification;return _this}_createClass(NotificationData,[{key:"get",value:function get(){var _this2=this;if(this.data){return Promise.resolve(this.data.json())}else{return _DataStore2.default.getItem(_config.DB_KEYS.VALUE_TO_CAPTURE).then(function(value){var notification=_this2.defaultNotification;notification.body=value;return notification}).catch(function(err){_Logger2.default.error("[NotificationData]: Notification Failed");return _this2.defaultNotification})}}}]);return NotificationData}(_ApiBase3.default);exports.default=NotificationData}]);